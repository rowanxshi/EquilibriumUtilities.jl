<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>EquilibriumUtilities.jl Documentation · Equilibrium Utilities</title><meta name="title" content="EquilibriumUtilities.jl Documentation · Equilibrium Utilities"/><meta property="og:title" content="EquilibriumUtilities.jl Documentation · Equilibrium Utilities"/><meta property="twitter:title" content="EquilibriumUtilities.jl Documentation · Equilibrium Utilities"/><meta name="description" content="Documentation for Equilibrium Utilities."/><meta property="og:description" content="Documentation for Equilibrium Utilities."/><meta property="twitter:description" content="Documentation for Equilibrium Utilities."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Equilibrium Utilities</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>EquilibriumUtilities.jl Documentation</a><ul class="internal"><li><a class="tocitem" href="#Iterative-convergence"><span>Iterative convergence</span></a></li><li><a class="tocitem" href="#Newton-method"><span>Newton method</span></a></li><li><a class="tocitem" href="#Small-utilities"><span>Small utilities</span></a></li><li><a class="tocitem" href="#WrappedDict"><span><code>WrappedDict</code></span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>EquilibriumUtilities.jl Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>EquilibriumUtilities.jl Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/rowanxshi/EquilibriumUtilities.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="EquilibriumUtilities.jl-Documentation"><a class="docs-heading-anchor" href="#EquilibriumUtilities.jl-Documentation">EquilibriumUtilities.jl Documentation</a><a id="EquilibriumUtilities.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#EquilibriumUtilities.jl-Documentation" title="Permalink"></a></h1><p>A small package of utilities commonly used to compute economic models.</p><p>Exports</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;EquilibriumUtilities, WrappedDict, chunk, converge, diag_view, infnorm_pctdev, issquare, newton, normalise!, offdiag_view, quietly, update!, zero_safe&quot;</code></pre><h2 id="Iterative-convergence"><a class="docs-heading-anchor" href="#Iterative-convergence">Iterative convergence</a><a id="Iterative-convergence-1"></a><a class="docs-heading-anchor-permalink" href="#Iterative-convergence" title="Permalink"></a></h2><p>The generalised iterative routine and its parametres:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.ConvergeParameters" href="#EquilibriumUtilities.ConvergeParameters"><code>EquilibriumUtilities.ConvergeParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">ConvergeParameters{T1 &lt;: Real, T2 &lt;: Integer, T3}</code></pre><p>Contains optional parameters for the <a href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>converge</code></a> solver.</p><p>See also <a href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>converge</code></a>.</p><p><strong>Fields</strong></p><ul><li><code>diff_tol::T1 = 1e-6</code>: If the value returned by <code>step_diff</code> is less than this tolerance, stop.</li><li><code>up_tol::T1 = zero(diff_tol)</code>: If the value returned by <code>update</code> is less than this tolerance, stop.</li><li><code>max_iter::T2 = 200</code>: Maximum number of iterations before giving up.</li><li><code>msg::T3 = &quot;No convergence&quot;</code>: Warning message to display if there isn&#39;t convergence within the maximum number of iterations.</li><li><code>verbose::Bool = false</code>: Print the <code>diff</code> every iteration?</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L2-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.converge-Tuple{Function, Function, Function}" href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>EquilibriumUtilities.converge</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">converge(update::Function, step_diff::Function, init::Function; kw...) -&gt; (converged, stalled_update)</code></pre><p>Iterate until convergence. In particular, the problem is initiated with <code>init()</code>. Then, repeatedly:</p><ul><li>apply <code>step_diff()</code> which should do an iteration step, then return the deviation</li><li>apply <code>update()</code>, which should return the size of the update</li></ul><p>until convergence. The convergence criterion is controlled by keyword arguments; see <a href="#EquilibriumUtilities.ConvergeParameters"><code>ConvergeParameters</code></a>.</p><p>The function returns a pair of booleans, the first of which indicates whether convergence was reached; the second of which indicates whether iteration was aborted because the update was too small.</p><p>For an example, see this package&#39;s tests which uses this function to solve the finite-firm CES game.</p><p>See also <a href="#EquilibriumUtilities.update!"><code>update!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L24-L37">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.converge-Union{Tuple{C}, Tuple{B}, Tuple{A}, Tuple{A, B, C, EquilibriumUtilities.ConvergeParameters}} where {A, B, C}" href="#EquilibriumUtilities.converge-Union{Tuple{C}, Tuple{B}, Tuple{A}, Tuple{A, B, C, EquilibriumUtilities.ConvergeParameters}} where {A, B, C}"><code>EquilibriumUtilities.converge</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">converge(update::Function, step_diff::Function, init::Function, p::ConvergeParameters)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L41-L43">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.infnorm_pctdev-Tuple{Any, Any}" href="#EquilibriumUtilities.infnorm_pctdev-Tuple{Any, Any}"><code>EquilibriumUtilities.infnorm_pctdev</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">infnorm_pctdev(v1, v2)</code></pre><p>Calculates the difference between two vectors by finding the maximum absolute percentage deviation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L91-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.update!" href="#EquilibriumUtilities.update!"><code>EquilibriumUtilities.update!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Optional helper function to use when writing an <code>update()</code> function for <a href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>converge</code></a>.</p><p>Update <code>main</code> according to <code>secondary</code>, with a <code>dampen</code>ing factor. Useful for iterative algorithms. Once complete, <code>main</code> will hold the updated value and <code>secondary</code> will hold main&#39;s original value (to keep a record of previous iteration).</p><p>Returns the <code>norm</code> of the update step (useful for breaking iteration if the step size is too small).</p><p>See also <a href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>converge</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L69-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.update!-Tuple{Any, Any}" href="#EquilibriumUtilities.update!-Tuple{Any, Any}"><code>EquilibriumUtilities.update!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">update!(main, secondary; norm = infnorm_pctdev, dampen = 0.5)</code></pre><p>See <a href="#EquilibriumUtilities.infnorm_pctdev-Tuple{Any, Any}"><code>infnorm_pctdev</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/converge.jl#L79-L83">source</a></section></article><h3 id="Reactive-dampening"><a class="docs-heading-anchor" href="#Reactive-dampening">Reactive dampening</a><a id="Reactive-dampening-1"></a><a class="docs-heading-anchor-permalink" href="#Reactive-dampening" title="Permalink"></a></h3><p><strong>Optional</strong> helpers, mostly implementing a dampening factor that dynamically adjusts as the equilibrium progresses.</p><p>The convergence routine above need not use this routine: the user can always define the <code>update()</code> function however they would like. However, this optional functionality allows the solver to choose a dampening factor taking into account the convergence path. It will be provided in the <code>ds::DampenState</code> <code>struct</code> so the user can access it when defining their <code>update()</code> function.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.DampenParameters" href="#EquilibriumUtilities.DampenParameters"><code>EquilibriumUtilities.DampenParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct DampenParameters{T1 &lt;: Real, T2 &lt;: Integer}</code></pre><p>Parameters for <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a>.</p><p><strong>Fields</strong></p><ul><li><code>loosen::T1 = -0.01</code>: by how much to loosen the dampening factor</li><li><code>tighten::T1 = 0.01</code>: by how much to tighten the dampening factor</li><li><code>min_dampen::T1 = 0.0</code>: the minimum value for the dampen factor</li><li><code>max_dampen::T1 = 0.999</code>: the maximum value for the dampen factor</li><li><code>scale::T1 = 0.925</code>: the scale mentioned in <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a></li><li><code>overshooting_share::T1 = 0.5</code>: the share for <a href="#EquilibriumUtilities.isovershooting-Tuple{Any, Any}"><code>isovershooting</code></a></li><li><code>grace_period::T2 = 50</code>: how long to wait between adjustments</li><li><code>tighten_wait::T2 = 30</code>: how long to wait between tightenings</li><li><code>loosen_wait::T2 = 40</code>: how long to wait between loosenings</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L61-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.DampenState" href="#EquilibriumUtilities.DampenState"><code>EquilibriumUtilities.DampenState</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">struct DampenState{T &lt;: AbstractVector{&lt;: Real}}</code></pre><p><strong>Fields</strong></p><ul><li><code>dampenstats::T = [0.85; Inf; Inf; Inf]</code>: contains, in order,<ul><li>the dampening factor</li><li>number of iterations since the dampening factor lowered</li><li>number of iterations since the dampening factor increased</li><li>the <code>diff</code> used when checking whether iteration is far along enough to attempt loosening again</li></ul></li><li><code>last_deviations::T2 = Float64[]</code> for storing deviations from the last iteration</li><li><code>penultimate_deviations::T2 = Float64[]</code> for storing deviations from the penultimate iteration</li><li><code>history::T2 = Float64[]</code> for storing the history of <code>diff</code>s</li></ul><p>See also <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a>, <a href="#EquilibriumUtilities.dampenfactor-Tuple{EquilibriumUtilities.DampenState}"><code>dampenfactor</code></a>, <a href="#EquilibriumUtilities.dampenfactor!-Tuple{EquilibriumUtilities.DampenState, Any}"><code>dampenfactor!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.converge-Tuple{Function, Function, Function, EquilibriumUtilities.DampenState, EquilibriumUtilities.ConvergeParameters}" href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function, EquilibriumUtilities.DampenState, EquilibriumUtilities.ConvergeParameters}"><code>EquilibriumUtilities.converge</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">converge(update::Function, step_diff::Function, init::Function, ds::DampenState, p::ConvergeParameters)</code></pre><p>Wrapper that <code>push!</code>es the calculated <code>diff</code> to <code>ds.history</code>, so that <code>ds</code> is up-to-date.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L164-L168">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.dampenfactor!-Tuple{EquilibriumUtilities.DampenState, Any}" href="#EquilibriumUtilities.dampenfactor!-Tuple{EquilibriumUtilities.DampenState, Any}"><code>EquilibriumUtilities.dampenfactor!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dampenfactor!(ds::DampenState, factor)</code></pre><p>Set the dampen factor in <code>ds</code>.</p><p>See also <a href="#EquilibriumUtilities.dampenfactor-Tuple{EquilibriumUtilities.DampenState}"><code>dampenfactor</code></a>, <a href="#EquilibriumUtilities.DampenState"><code>DampenState</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L49-L55">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.dampenfactor-Tuple{EquilibriumUtilities.DampenState}" href="#EquilibriumUtilities.dampenfactor-Tuple{EquilibriumUtilities.DampenState}"><code>EquilibriumUtilities.dampenfactor</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dampenfactor(ds::DampenState)</code></pre><p>Retrieve the dampen factor from <code>ds</code>.</p><p>See also <a href="#EquilibriumUtilities.dampenfactor!-Tuple{EquilibriumUtilities.DampenState, Any}"><code>dampenfactor!</code></a>, <a href="#EquilibriumUtilities.DampenState"><code>DampenState</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L39-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}" href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>EquilibriumUtilities.dynamicdampen!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dynamicdampen!(ds::DampenState, p::DampenParameters)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L107-L109">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState}" href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState}"><code>EquilibriumUtilities.dynamicdampen!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">dynamicdampen!(ds::DampenState; kw...)</code></pre><p>Update the dampening factor based on convergence path. Strategy:</p><ul><li>increase by <code>ds.tighten</code> if <code>ds.history</code> <a href="#EquilibriumUtilities.isdiverging-Tuple{Any}"><code>isdiverging</code></a> or <a href="#EquilibriumUtilities.isovershooting-Tuple{Any, Any}"><code>isovershooting</code></a></li><li>make no change if any of:<ul><li>within the first <code>p.grace_period</code> iterations</li><li>it has been under <code>p.tighten_wait</code> iterations since the last tightening</li><li>it has been under <code>p.loosen_wait</code> iterations since the last loosening</li><li>the current difference is above <code>p.scale*ds.reference_diff</code></li></ul></li><li>otherwise, decrease by <code>loosen</code></li></ul><p>Fine tune control through keyword arguments; see <a href="#EquilibriumUtilities.DampenParameters"><code>DampenParameters</code></a>.</p><p>See also <a href="#EquilibriumUtilities.DampenState"><code>DampenState</code></a>, <a href="#EquilibriumUtilities.DampenParameters"><code>DampenParameters</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L89-L103">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.isdiverging-Tuple{Any}" href="#EquilibriumUtilities.isdiverging-Tuple{Any}"><code>EquilibriumUtilities.isdiverging</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">isdiverging(history)</code></pre><p>Checks if iteration is on a bad path, by seeing if two of the past three iterations have worsened the difference. If updating is too aggressive, usually one of two things happens:</p><ul><li>the difference blows up (if updating is <em>too</em> aggressive)</li><li>the difference oscillates between improving and worsening (if updating is a little too aggressive)</li></ul><p>See also <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L131-L139">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.isovershooting-Tuple{Any, Any}" href="#EquilibriumUtilities.isovershooting-Tuple{Any, Any}"><code>EquilibriumUtilities.isovershooting</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">isovershooting(last_deviations, penultimate_deviations; share = 0.5)</code></pre><p>Check if the convergence is overshooting each guess, as measured by a <code>share</code> of the deviations flipping signs between the last two iterations. If dampening isn&#39;t strong enough, the deviations alternate between positive and negative, wasting time by bouncing back and forth. Increasing the dampening can drastically speed up convergence by preventing this oscillation.</p><p>See also <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L147-L153">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.update!-Tuple{Any, Any, EquilibriumUtilities.DampenState}" href="#EquilibriumUtilities.update!-Tuple{Any, Any, EquilibriumUtilities.DampenState}"><code>EquilibriumUtilities.update!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">update!(main, secondary, ds::DampenState; kw...)</code></pre><p>Update using a dynamically-chosen dampening factor. However, if the user supplies the keyword argument <code>dampen</code>, it takes precedence over dynamically-chosen dampening factor.</p><p>See also <a href="#EquilibriumUtilities.dynamicdampen!-Tuple{EquilibriumUtilities.DampenState, EquilibriumUtilities.DampenParameters}"><code>dynamicdampen!</code></a>, <a href="#EquilibriumUtilities.DampenState"><code>DampenState</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/dynamicdampen.jl#L178-L184">source</a></section></article><h2 id="Newton-method"><a class="docs-heading-anchor" href="#Newton-method">Newton method</a><a id="Newton-method-1"></a><a class="docs-heading-anchor-permalink" href="#Newton-method" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.NewtonParameters" href="#EquilibriumUtilities.NewtonParameters"><code>EquilibriumUtilities.NewtonParameters</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">NewtonParameters</code></pre><p>Contains optional parameters for the <a href="#EquilibriumUtilities.newton"><code>newton</code></a> solver.</p><p>See also <a href="#EquilibriumUtilities.newton"><code>newton</code></a>.</p><p><strong>Fields</strong></p><ul><li><code>verbose::Bool = false</code>: Print some info every iteration?</li><li><code>step_tol::Float64 = 1e-8</code>: If the (absolute value of) step size is smaller than this tolerance, stop.</li><li><code>f_tol::Float64 = step_tol</code>: If the (absolute value of) function value is smaller than this tolerance, stop.</li><li><code>max_iter::Integer = 750</code>: Maximum number of iterations before giving up.</li><li><code>msg = &quot;No Newton convergence&quot;</code>: Warning message to display if there isn&#39;t convergence within the maximum number of iterations.</li><li><code>l::Real = -Inf</code>: Left bound.</li><li><code>r::Real = Inf</code>: Right bound.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/newton.jl#L1-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.newton" href="#EquilibriumUtilities.newton"><code>EquilibriumUtilities.newton</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Simple Newton method implementation.</p><p>See also <a href="#EquilibriumUtilities.NewtonParameters"><code>NewtonParameters</code></a> for more keyword argument options.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/newton.jl#L28-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.newton-Tuple{Function, Any}" href="#EquilibriumUtilities.newton-Tuple{Function, Any}"><code>EquilibriumUtilities.newton</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">newton(f_f′, x; kwargs...)</code></pre><p><code>f_f′</code> should be a function which returns the tuple <code>(f, f′)</code> of function value and derivative. <code>x</code> is the initial guess.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/newton.jl#L35-L39">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.newton-Tuple{Function, Function, Any}" href="#EquilibriumUtilities.newton-Tuple{Function, Function, Any}"><code>EquilibriumUtilities.newton</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">newton(f, f′, x; kwargs...)</code></pre><p><code>f</code> should be a function which returns the function value and <code>f′</code> its derivative. <code>x</code> is the initial guess.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/newton.jl#L74-L78">source</a></section></article><h2 id="Small-utilities"><a class="docs-heading-anchor" href="#Small-utilities">Small utilities</a><a id="Small-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Small-utilities" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.EquilibriumUtilities" href="#EquilibriumUtilities.EquilibriumUtilities"><code>EquilibriumUtilities.EquilibriumUtilities</code></a> — <span class="docstring-category">Module</span></header><section><div><p>A package of basic utility functions used commonly when computing economic equilibria.</p><p>See <a href="#EquilibriumUtilities.converge-Tuple{Function, Function, Function}"><code>converge</code></a>, <a href="#EquilibriumUtilities.newton"><code>newton</code></a>, <a href="#EquilibriumUtilities.normalise!"><code>normalise!</code></a>, <a href="#EquilibriumUtilities.zero_safe-Tuple{Any}"><code>zero_safe</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/EquilibriumUtilities.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.normalise!" href="#EquilibriumUtilities.normalise!"><code>EquilibriumUtilities.normalise!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">normalise!(v, factor = zero_safe(first(v)))</code></pre><p>Normalise <code>v</code> by some <code>factor</code>. Useful for normalising nominal prices (so the first element is the numeraire) or shares (with <code>factor = sum(v)</code>).</p><p>See also <a href="#EquilibriumUtilities.zero_safe-Tuple{Any}"><code>zero_safe</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/EquilibriumUtilities.jl#L11-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.quietly-Tuple{Function}" href="#EquilibriumUtilities.quietly-Tuple{Function}"><code>EquilibriumUtilities.quietly</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">quietly(f::Function)</code></pre><p>Execute something without logging it (sends logs to <code>Logging.NullLogger()</code>).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/EquilibriumUtilities.jl#L27-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.zero_safe-Tuple{Any}" href="#EquilibriumUtilities.zero_safe-Tuple{Any}"><code>EquilibriumUtilities.zero_safe</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">zero_safe(x)</code></pre><p>If <code>x</code> is zero, return <code>one(x)</code>. Otherwise, return <code>x</code>. Useful for safely dividing by <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/EquilibriumUtilities.jl#L21-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.chunk-Tuple{AbstractVector, Integer}" href="#EquilibriumUtilities.chunk-Tuple{AbstractVector, Integer}"><code>EquilibriumUtilities.chunk</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">chunk(V::AbstractVector, N::Integer)</code></pre><p>Chunk a vector <code>V</code> into <a href="https://docs.julialang.org/en/v1/base/arrays/#Base.view"><code>Base.view</code></a>s each of length <code>N</code>. Returns a <code>Tuple</code> of <a href="https://docs.julialang.org/en/v1/base/arrays/#Base.view"><code>Base.view</code></a>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/arrayviews.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.diag_view-Tuple{AbstractMatrix}" href="#EquilibriumUtilities.diag_view-Tuple{AbstractMatrix}"><code>EquilibriumUtilities.diag_view</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">diag_view(mat::AbstractMatrix)</code></pre><p>Returns a view of the matrix diagonal, assuming one-based indexing.</p><p>See also <a href="#EquilibriumUtilities.offdiag_view-Tuple{AbstractMatrix}"><code>offdiag_view</code></a>, <a href="#EquilibriumUtilities.issquare-Tuple{AbstractMatrix}"><code>issquare</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/arrayviews.jl#L10-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.issquare-Tuple{AbstractMatrix}" href="#EquilibriumUtilities.issquare-Tuple{AbstractMatrix}"><code>EquilibriumUtilities.issquare</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">issquare(mat::AbstractMatrix)</code></pre><p>Is the matrix square?</p><p>See also <a href="#EquilibriumUtilities.diag_view-Tuple{AbstractMatrix}"><code>diag_view</code></a>, <a href="#EquilibriumUtilities.offdiag_view-Tuple{AbstractMatrix}"><code>offdiag_view</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/arrayviews.jl#L36-L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.offdiag_view-Tuple{AbstractMatrix}" href="#EquilibriumUtilities.offdiag_view-Tuple{AbstractMatrix}"><code>EquilibriumUtilities.offdiag_view</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">offdiag_view(mat::AbstractMatrix)</code></pre><p>Returns a view of the matrix off-diagonals, assuming one-based indexing.</p><p>See also <a href="#EquilibriumUtilities.diag_view-Tuple{AbstractMatrix}"><code>diag_view</code></a>, <a href="#EquilibriumUtilities.issquare-Tuple{AbstractMatrix}"><code>issquare</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/arrayviews.jl#L22-L28">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.pretty" href="#EquilibriumUtilities.pretty"><code>EquilibriumUtilities.pretty</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">pretty(s, var_names = keys(s); kw...)</code></pre><p>Return a string version of <code>s</code> for pretty-printing.</p><p><strong>Keywords</strong></p><ul><li><code>pad = 8</code>: column width</li><li><code>digits = 4</code>: number of digits to round to</li><li><code>spacer = 2</code>: number of spaces in between columns</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/prettyprinting.jl#L8-L17">source</a></section></article><h2 id="WrappedDict"><a class="docs-heading-anchor" href="#WrappedDict"><code>WrappedDict</code></a><a id="WrappedDict-1"></a><a class="docs-heading-anchor-permalink" href="#WrappedDict" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.WrappedDict" href="#EquilibriumUtilities.WrappedDict"><code>EquilibriumUtilities.WrappedDict</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">abstract type WrappedDict{T} &lt;: AbstractDict{Symbol, T}</code></pre><p>Eases creating custom <code>struct</code>s that are basically dictionaries. (Essentially implements <code>keys</code>, <code>values</code>, <code>length</code>, <code>iterate</code>, <code>getindex</code>, <code>setindex!</code>, <code>get</code>, and <code>get!</code> by delegating to the necessary field <code>internal_dict</code>.)</p><p>A concrete subtype of <code>WrappedDict</code> <em>must</em> have a field <code>internal_dict::Dict{Symbol, T}</code>, which is the dictionary.</p><p>For an example, see this package&#39;s tests with an implementation of a Pollak demand function <code>struct</code> as a <code>WrappedDict</code>.</p><p>See also <a href="#EquilibriumUtilities.validate-Tuple{Any, Any}"><code>validate</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/WrappedDict.jl#L1-L11">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="EquilibriumUtilities.validate-Tuple{Any, Any}" href="#EquilibriumUtilities.validate-Tuple{Any, Any}"><code>EquilibriumUtilities.validate</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">validate(given, needed)</code></pre><p>For each key in <code>needed</code>, check that it&#39;s present in <code>given</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/rowanxshi/EquilibriumUtilities.jl/blob/7d5a23622864ad4fc2f5376016299c37f06f1bfe/src/WrappedDict.jl#L27-L31">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Thursday 16 May 2024 19:04">Thursday 16 May 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
